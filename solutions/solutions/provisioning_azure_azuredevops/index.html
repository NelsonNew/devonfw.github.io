<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ******** SOCIAL MEDIA META ********** -->

<meta name="title" property="og:title" content="devonfw website">
<meta property="og:type" content="website">
<meta name="image" property="og:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="description" property="og:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta property="og:url" content="https://devonfw.com/index.html">

<meta name="twitter:title" content="devonfw website">
<meta name="twitter:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta name="twitter:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="twitter:card" content="summary_large_image">

<!-- ************************************* -->


<title>Provisioning Solutions - Azure DevOps</title>
<!-- devonfw website stylesheet -->
<link rel="stylesheet" type="text/css" href="/devonfw.css">
<!-- Ubuntu Font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400&display=swap" rel="stylesheet">
<!-- Lunr -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.6/lunr.min.js" integrity="sha256-M/Awbb/BYh+Rh0aGjpQid26p1b2OBsrk2k9yAvQxPV0=" crossorigin="anonymous"></script>
<!-- JQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/styles/googlecode.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/lang/common.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>

<script src="/website/components/header/search-engine/bundle.js"></script>

<script src="/website/shared/rightmenu.js"></script>

<!-- ************** Google analytics ************ -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151636804-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151636804-1');
</script>

<!-- ******************************************** -->


<link rel="stylesheet" type="text/css" href="https://cginternal.devonfw.com/websitesnippets/main.css">
<script src="https://cginternal.devonfw.com/websitesnippets/main.js"></script>
</head>
<body class="article">
<div id="website-navbar" class="website-navbar">
<button id="menu-button" class="menu-button">
  <img src="/images/menu-button.svg" width="32px" height="32px" alt=""/>
</button>

<ul>
<li>
<p><span class="image"><a class="image" href="/website/pages/welcome/welcome.html"><img alt="logo" src="/images/Logo_devonfw.svg"></a></span></p>
</li>
<li>
<p><a href="https://www.katacoda.com/devonfw">Tutorials</a></p>
</li>
<li>
<p><a href="/website/pages/solutions/index.html">Solutions</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Docs</a></p>
</li>
</ul>

<form class="form-inline">
  <div class="search-bar">
    <input
      id="search-field"
      type="search"
      class="form-control mr-sm-2"
      placeholder="Search by keyword(s)..."
      aria-label="Search"
      style="height: auto;"
      autocomplete="off"/>
    <div class="sb-res-pos px-4">
      <div id="click-outside" class="click-outside z-50 hidden"></div>
      <div class="col rounded px-0 border z-100 bg-white hidden search-bar-results" id="search-results-box">
      </div>
    </div>
  </div>
</form>
<a class="navbar-github text-white" href="https://github.com/devonfw/">
  <img src="/images/github-mark.png" width=auto height=auto alt="">
</a></div>
<div id="sidebar" class="wiki-sidebar"></div>

<div id="content" class="mt-4 mt-sm-5">
<div class="toc2">
<div class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#index.asciidoc_provisioning-solutions---azure-devops">Provisioning Solutions - Azure DevOps</a>
<ul class="sectlevel2">
<li><a href="#index.asciidoc_overview">Overview</a></li>
<li><a href="#index.asciidoc_pattern-details">Pattern Details</a></li>
<li><a href="#index.asciidoc_variations">Variations</a></li>
<li><a href="#index.asciidoc_when-to-use">When to use</a></li>
</ul>
</li>
<li><a href="#index.asciidoc_credits">Credits</a></li>
</ul>
<div class="sect1">
<h2 id="index.asciidoc_provisioning-solutions---azure-devops">Provisioning Solutions - Azure DevOps</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="index.asciidoc_overview">Overview</h3>
<div class="paragraph">
<p>The cloud native provisioning service in Azure is Azure DevOps formerly known as Team Foundation Server (TFS). Azure DevOps covers the full CI/ CD requiremenzs including project management. Due to its extensive extension features you can also replace features with other alternatives (see also under variations).</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Azure DevOps will be superseeded by GitHub in the long run after Microsoft acquired GitHub. New features will be initially implemented there.</p>
</div>
<div class="paragraph">
<p>The services that (can) complement Azure DevOps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Azure Key Vault for storing secrets/ exchange of settings</p>
</li>
<li>
<p>Azure App Configuration</p>
<div class="paragraph">
<p>This service provides settings (key-value pairs) and feature toggles. Native integrations exist for typical application programming languages like .NET/ Java. However native integrations with terraform do not exist and it is also not hardened for sensitive information as key vault. Therefore, it is recommended to use that service as special case for application layer if feature toggles are needed.</p>
</div>
</li>
<li>
<p>Azure AD</p>
<div class="paragraph">
<p>Azure Active Directory provides the service principal the pipelines run with.</p>
</div>
</li>
<li>
<p>Monitoring</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Azure DevOps generates metrics to check the health pipelines and displays te state in the Azure DevOps portal. However no built-in forwarding to App Insights independent from the deployed application exists. The following options are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Continous monitoring: Monitoring which assumes Web Applications.</p>
</li>
<li>
<p>Rest API to read service health information manually as explained <a href="https://docs.microsoft.com/en-us/rest/api/azure/devops/status/?view=azure-devops-rest-6.0">here</a>. Check out the pattern monitoring cloudnative how polling and forwarding to azure monitor can be achieved.</p>
</li>
<li>
<p>audit streaming is similar to diagnostic settings (In preview as of 21.09.2021). It allows to configure a constant forwarding of telemetry to selected targets as described <a href="https://docs.microsoft.com/en-us/azure/devops/organizations/audit/auditing-streaming?view=azure-devops">here</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Structural elements to model environments</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The picture illustrates the setup with the major dependencies:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/complementing_svcs_devops.png" alt="Complementing Services" width="594" height="335">
</div>
</div>
</div>
<div class="sect2">
<h3 id="index.asciidoc_pattern-details">Pattern Details</h3>
<div class="sect3">
<h4 id="index.asciidoc_geting-started">Geting Started</h4>
<div class="paragraph">
<p>Many aspects influence the setup of the service. Following a top down approach the following decisions have to be made:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define landing zone of the service itself in Azure (out of scope)</p>
</li>
<li>
<p>Organizational mapping</p>
<div class="paragraph">
<p>This yields the structural components to host provisioning which will be detailed in the next chapter. It introduces the possible components and guidelines for its structuring.</p>
</div>
</li>
<li>
<p>Modelling other outlined aspects across automation, infra/ app code and provisioning</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The structural components are organizations, teams and projects. A team is a unit that supports many team-configurable tools. These tools help you plan and manage work, and make collaboration easier. Every team owns their own backlog, to create a new backlog you create a new team. By configuring teams and backlogs into a hierarchical structure, program owners can more easily track progress across teams, manage portfolios, and generate rollup data.</p>
</div>
<div class="paragraph">
<p>A project in Azure DevOps contains the following set of features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Boards and backlogs for agile planning</p>
</li>
<li>
<p>Pipelines for continuous integration and deployment</p>
</li>
<li>
<p>Repos</p>
<div class="paragraph">
<p>The service comes with hosted git repositories inside that service. You can also use the following external source repositories: Bitbuckt Cloud, GitHub, Any generic git repo, Subversion</p>
</div>
</li>
<li>
<p>Testing</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Azure DevOps supports the following testing by <a href="https://docs.microsoft.com/en-us/azure/devops/test/create-test-cases?view=azure-devops">defining test suites with test cases</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Planned manual testing</strong>. Manual testing by organizing tests into test plans and test suites by designated testers and test leads.</p>
</li>
<li>
<p><strong>User acceptance testing</strong>. Testing carried out by designated user acceptance testers to verify the value delivered meets customer requirements, while reusing the test artifacts created by engineering teams.</p>
</li>
<li>
<p><strong>Exploratory testing</strong>. Testing carried out by development teams, including developers, testers, UX teams, product owners and more, by exploring the software systems without using test plans or test suites.</p>
</li>
<li>
<p><strong>Stakeholder feedback</strong>. Testing carried out by stakeholders outside the development team, such as users from marketing and sales divisions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tests can also be integrated in pipelines. Pipelines support a wide range of frameworks/ libraries.</p>
</div>
</div>
</div>
</li>
<li>
<p>Each organization contains one or more projects</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Your business structure should act as a guide for the number of organizations, projects, and teams that you create in <a href="https://docs.microsoft.com/en-us/azure/devops/user-guide/plan-your-azure-devops-org-structure?bc=%2Fazure%2Fdevops%2Fget-started%2Fbreadcrumb%2Ftoc.json&amp;toc=%2Fazure%2Fdevops%2Fget-started%2Ftoc.json&amp;view=azure-devops">Azure DevOps</a>. Each organization gets its own free tier of services (up to five users for each service type) as follows. You can use all the services, or choose just what you need to complement your existing workflows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Azure Pipelines: One hosted job with 1,800 minutes per month for CI/CD and one self-hosted job</p>
</li>
<li>
<p>Azure Boards: Work item tracking and Kanban boards</p>
</li>
<li>
<p>Azure Repos: for version control and management of source code and artifacts</p>
</li>
<li>
<p>Azure Artifacts: Package management</p>
</li>
<li>
<p>Testing: Continuous test integration throughout the project life cycle</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Adding multiple projects makes sense in the following cases (see <a href="https://docs.microsoft.com/en-us/azure/devops/organizations/projects/about-projects?view=azure-devops">azure projects</a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To prohibit or manage access to the information contained within a project to select groups</p>
</li>
<li>
<p>To support custom work tracking processes for specific business units within your organization</p>
</li>
<li>
<p>To support entirely separate business units that have their own administrative policies and administrators</p>
</li>
<li>
<p>To support testing customization activities or adding extensions before rolling out changes to the working project</p>
</li>
<li>
<p>To support an Open Source Software (OSS) project</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Adding teams instead of projects is recommended over projects due to <a href="https://docs.microsoft.com/en-us/azure/devops/boards/plans/agile-culture?view=azure-devops">agile culture</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Visibility: It&#8217;s much easier to view progress across all teams</p>
</li>
<li>
<p>Tracking and auditing: It&#8217;s easier to link work items and other objects for tracking and auditing purposes</p>
</li>
<li>
<p>Maintainability: You minimize the maintenance of security groups and process updates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The table below lists typical configurations along with their characteristics:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Criteria</th>
<th class="tableblock halign-left valign-top">1 project, N teams</th>
<th class="tableblock halign-left valign-top">1 org, N projects/ teams</th>
<th class="tableblock halign-left valign-top">N orgs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">General guidance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smaller or larger organizations with highly aligned teams</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Good when different efforts require different processes (multi)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Legacy migration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aligned processes across teams; team flexibility to customize boards, dashboards, and so on</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Different processes per prj;e.g. different work item types, custom fields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">same as many projects</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="index.asciidoc_remaining-goals-automation-code">Remaining goals (Automation Code)</h4>
<div class="paragraph">
<p>This chapter details how the above conceptual features can be achieved with Azure DevOps pipelines.</p>
</div>
<div class="paragraph">
<p>The pipeline <strong>programming approach</strong> can be either UI driven or programmatic by using YAML. YAML organizes pipelines into a hierarchy of stages, jobs and tasks. Tasks are the workhorse where activities are implemented. Tasks support scripting languages as stated below. They in turn allow to install additional libraries frameworks from third party providers such as terraform (or you use extensions that give you additional task types). The list below highlights a few YAML points you have to be aware of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Passing files/ artefacts between jobs/ pipelines</p>
<div class="paragraph">
<p>Passing between jobs within the same pipeline requires publishing the files as pipeline artefacts and downloading it afterwards. Passing between syntax requires a different syntax and also requires a version.</p>
</div>
</li>
<li>
<p>Variables</p>
<div class="paragraph">
<p>Variables can have different scopes. A special syntax is required to publish them at runtime and to consume them in a different job (requires declaration). (<a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/process/variables?view=azure-devops&amp;tabs=yaml%2Cbatch">Link</a>). Various <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/build/variables?view=azure-devops&amp;tabs=yaml">predefined</a> exist.</p>
</div>
</li>
<li>
<p>Obtaining client secret</p>
<div class="paragraph">
<p>Scripting languages such as terraform might require the client secret for embedded scripting blocks. However,  terraform does not provide a way to get it. The only way was to include an AzureCLI scripting task. Setting the argument "addSpnToEnvironment" to true makes the value for scripting languages as environment variable. A script can then publish the variable so that the value is available in the YAML pipeline.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pipelines that shall be <strong>triggered</strong> by pushing to the repo state in the trigger element the details like branch when they shall run.
The example below shows a scheduled trigger:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="YAML language-YAML"># Disable all other triggers
pr: none
trigger: none

# Define schedule
schedules:
# Note: Azure DevOps only understands the limited part of the cron
#       expression below. See this link for further details:
#       https://docs.microsoft.com/en-us/azure/devops/pipelines/process/scheduled-triggers?view=azure-devops&amp;tabs=yaml
# Note: With DevOps organization setting of UTC+1 Berlin,...
#       for a given hour x you have to specify x-2 e.g. 16:00 will be
#       started 18:00 o'clock
- cron: "30 5 * * MON,TUE,WED,THU,FRI"
  displayName: Business daily morning creation
  always: true # also run if no code changes
  branches:
    include:
    - 'refs/heads/master'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pull request (PR) triggers cause a pipeline to run whenever a pull request is opened with one of the specified target branches, or when changes are pushed to such a pull request. In Azure Repos Git, this functionality is implemented using branch policies. To enable pull request validation in Azure Git Repos, navigate to the branch policies for the desired branch, and configure the Build validation policy for that branch. For more information, see Configure branch policies. Draft pull requests do not trigger a pipeline even if you configure a branch policy. Building pull requests from Azure Repos forks is no different from building pull requests within the same repository or project. You can create forks only within the same organization that your project is part of (see <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/repos/azure-repos-git?view=azure-devops&amp;tabs=yaml#pr-triggers">PR triggers</a>).
To trigger a pipeline upon the completion of another pipeline, specify the triggering pipeline as a pipeline resource. The following example has two pipelines - app-ci (the pipeline defined by the YAML snippet), and security-lib-ci (the triggering pipeline referenced by the pipeline resource). We want the app-ci pipeline to run automatically every time a new version of security-lib-ci is built.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="YAML language-YAML"># this is being defined in app-ci pipeline
resources:
  pipelines:
  - pipeline: securitylib   # Name of the pipeline resource
    source: security-lib-ci # Name of the pipeline referenced by the pipeline resource
    project: FabrikamProject # Required only if the source pipeline is in another project
    trigger: true # Run app-ci pipeline when any run of security-lib-ci completes</code></pre>
</div>
</div>
<div class="paragraph">
<p>Implicit Chaining for <strong>orchestration</strong> is possible by using trigger condition. Calling pipelines explicitly is so far only possible with scripting. The code snippet below shows an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="Powershell language-Powershell">#
# Make call to schedule pipeline run
#

# Body
$body = @{
    stagesToSkip = @()
    resources = @{
        self = @{
            refName = $branch_name
        }
    }
    templateParameters = $params
    variables = @{}
}
$bodyJson = $body | ConvertTo-Json
# Uri extracted from the Azure DevOps UI
# $org_uri and $prj_id contain names of current organization/ project
# $pl_id denotes the internal pipeline id to be started
$uri = "${org_uri}${prj_id}/_apis/pipelines/${pl_id}/runs?api-version=5.1-preview.1"

# Output paramters
Write-Host("--------  Call ${pl_name} --------")
Write-Host("Headers: ${headersJson}")
Write-Host("Json body: ${bodyJson}")
Write-Host("Uri: ${uri}")

try
{
    # Trigger pipeline
    $result = Invoke-RestMethod -Method POST -Headers $headers -Uri $uri -Body $bodyJson
    Write-Host("Result: ${result}")

    # Wait until run completed
    $buildid = $result.id
    $start_time = (get-date).ToString('T')
    Write-Host("------------ Loop until ${pl_name} completed --------")
    Write-Host("started runbuild ${buildid} at ${start_time}")

    # Uri for checking state
    $uri = "${org_uri}${prj_id}/_apis/pipelines/${pl_id}/runs/${buildid}?api-version=5.1-preview.1"

    Do {
        Start-Sleep -Seconds 60
        $current_time = (get-date).ToString('T')

        # Retrieve current state
        $result = Invoke-RestMethod -Method GET -Headers $headers -Uri $uri
        $status = $result.state
        Write-Host("Received state ${status} at ${current_time}...")
    } until ($status -eq "completed")

    # return result
    $pl_run_result = $result.result
    Write-Host("Result: ${pl_run_result}")
    return $pl_run_result
}
catch {
    $excMsg = $_.Exception.Message
    Write-Host("Exception text: ${excMsg}")
    return "Failed"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Orchestration must take dependencies into account. They might result from the deployed code or the scope of the pipeline (scope is e.g. a single microservice and code includes the libraries needed).
Orchestrated pipelines must pass data between them. The recommended method is to use key vault.</p>
</div>
<div class="paragraph">
<p><strong>Recreation of resources in short intervals</strong> might cause pipelines to fail. Even if resources are deleted they might still exist in the background (even although soft delete is not applicable). Programming languages can therefore get confused if pipelines recreate things in short intervals. Creating a new resource group can solve the problem since they are part of the tecnical resource id.</p>
</div>
<div class="paragraph">
<p>As part of the <strong>configuration</strong> Azure DevOps provides the possibility to provide various settings that are used for development such as enforcing pull requests instead of direct pushes to the repo.
The major configuration mechanisms in YAML are variables, parameters and variable groups. Variable groups bundle multiple settings as key value pairs. Parameters are not possible in a variable section (Dynamic inclusion of variable groups is possible via file switching). If they are declared on top level they have to be passed when the pipeline is called programmatically or manually by the user.</p>
</div>
<div class="paragraph">
<p><strong>Quality gates</strong> can be enforced as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Static code analysis:</p>
<div class="paragraph">
<p>Various tool support exists depending on the programming language.</p>
</div>
</li>
<li>
<p>Automated tests (Unit, Integration, End-To-End)</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Tests can be included in pipelines via additional libraries and additional previous installment through scripting. The task below uses an Azure CLI task to run tests for terraform:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="YAML language-YAML">  - task: AzureCLI@2
    displayName: Run terratest
    inputs:
      azureSubscription: ${{parameters.svcConn}}
      scriptType: bash
      scriptLocation: 'inlineScript'
      addSpnToEnvironment: true
      inlineScript: |
        # Expose required settings as environment variables
        # ARM_XXX initialized by task due to addSpnToEnvironment = true
        subsid=`az account show --query id -o tsv`
        echo "client_id:"$servicePrincipalId
        echo "client_secret:"$servicePrincipalKey
        echo "subscription_id:"$subsid
        echo "tenant_id:"$tenantId
        export ARM_SUBSCRIPTION_ID=$subsid
        export ARM_CLIENT_ID=$servicePrincipalId
        export ARM_CLIENT_SECRET=$servicePrincipalKey
        export ARM_TENANT_ID=$tenantId
        # Backend settings
        export storage_account_name=${{parameters.bkStname}}
        export container_name=${{parameters.bkCntName}}
        export key=${{parameters.bkRmKeyName}}
        # Other settings
        export resource_group_name=${{parameters.rgName}}
        # Switch to directory with tests
        pwd
        cd test
        # Testfile must end with "&lt;your name&gt;_test.go"
        go test -v my_test.go</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Manual approval e.g. for production</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>YAML allows deployments to named environments. Approvers can then be defined for the named environments in the portal what causes the deployment pipeline to wait. However Approval must be done multiple times if you have multiple deplyoment blocks. The example below shows a deployment to the environment "env-demo":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="YAML language-YAML">jobs:
- deployment:
  displayName: run deploy template
  pool:
    vmImage: 'ubuntu-latest'
environment: env-demo
  strategy:
    runOnce:
      deploy:
        steps:
        # - 1. Download artefact
        - task: DownloadPipelineArtifact@2
          displayName: Get artefact
          inputs:
            downloadPath: '$(build.artifactstagingdirectory)'
            artifact: ${{parameters.pipelineArtifactName}}</code></pre>
</div>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="index.asciidoc_remaining-goals-provisioning">Remaining goals (Provisioning)</h4>
<div class="paragraph">
<p><strong>Configuration settings</strong> can be broken down into key value pairs. As already stated key vault is the recommended place for storage. Azure App Configuration and variable groups can reference values in Key Vault. Key Value pairs must be selected in YAML based on the target environment. Switching based on the parameter value is possible by constructing filenames based on the parameter value. The resolved filenam contains then the variable group or the key value pairs. as shown below:</p>
</div>
<div class="paragraph">
<p>(1) Main pipeline that requires switching</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="YAML language-YAML">...
# Switch in the pipeline which is implemented in a shared repository
variables:
- template: ./pipelines/configurations/vars-env-single-template.yaml@repo-shared
  parameters: ${{parameters.envName}}
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>(2) Shared: Switch to correct configuration file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="YAML language-YAML">...
parameters:
- name: envName
  displayName: name of environment
  type: string

# Load filename with resolved parameter value
variables:
- template: vars-env-def-${{parameters.envName}}-template.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>(3) Shared: Configuration file vars-env-def-dev1.yaml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="YAML language-YAML">variables:
  envNamePPE1MainScriptLocation: app/dev
  envNamePPE1SvcLevel: Full
  envNamePPE1BranchName: dev
  envNamePPE1KvEnvName: $(envNameCRST)1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Azure DevOps <strong>can integrate</strong> with various external tools. Pipelines can be called from external and allow calling external tools. Various third party tools can be manually installed or used via extensions.</p>
</div>
<div class="paragraph">
<p>For <strong>compliance</strong> Azure DevOps provides various settings inside Azure DevOps itself and via Azure Active Directory.
Portal access to Boards, Repos, Pipelines, Artifacts and Test Plans can be controlled through Azure DevOps project settings (<a href="https://docs.microsoft.com/en-us/azure/devops/organizations/settings/set-services?view=azure-devops">Link</a>).
Azure DevOps supports the following autthentication mechanisms to connect to services and resources in your organization (<a href="https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/change-application-access-policies?view=azure-devops">Link</a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OAuth to generate tokens for accessing REST APIs for Azure DevOps. The Organizations and Profiles APIs support only OAuth.</p>
</li>
<li>
<p>SSH authentication to generate encryption keys for using Linux, macOS, and Windows running Git for Windows, but you can&#8217;t use Git credential managers or personal access tokens (PATs) for HTTPS authentication.</p>
</li>
<li>
<p>Personal access token (PAT) to generate tokens for:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Accessing specific resources or activities, like builds or work items</p>
</li>
<li>
<p>Clients like Xcode and NuGet that require usernames and passwords as basic credentials and don&#8217;t support Microsoft account and Azure Active Directory features like multi-factor authentication</p>
</li>
<li>
<p>Accessing REST APIs for Azure DevOps</p>
</li>
</ul>
</div>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>User permissions for team members are split in access levels and project permissions inside Azure DevOps. The Basic and higher access levels support full access to all Azure Boards features. Stakeholder access provides partial support to select features, allowing users to view and modify work items without having access to all other features. Additional restrictions are possible by Azure Active Directory settings using conditional access policies and MFA. Azure DevOps honors all conditional access policies 100% for our Web flows. For third-party client flow, like using a PAT with git.exe, IP fencing policies are supported only (no support for MFA policies).
Permissions to work with repositories can be set under project’s repositories settings which also allows to disable forks. Many forks makes it hard to keep the overview and forking allows to download code into someones private account. Azure DevOps supports creating branch protection policies, which protect the code committed to the main branches (project settings &#8658; repo &#8658; branch policies).
Compliance affects dealing with sensitive settings. As already stated key vault is the standard service for storing them at runtime. Exports from key vault can only be decrypted in a key vault instance.
Hence, secrets can be stored in a repository in a safe way without having to store the values in plain. Using them later should be done in a safe way. This includes publishing them in a safe way and passing them from YAML to terraform by avoiding log output in plain text. Avoiding log output passing them as environment variables/ files.</p>
</div>
<div class="paragraph">
<p>The following <strong>repository</strong> structure shows a conceptual breakdown that covers most aspects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1. Infra</p>
</li>
<li>
<p>1.1. Infrastructure</p>
</li>
<li>
<p>1.1.1. Other landing zones</p>
<div class="paragraph">
<p>Represents other areas with shared functionality that are required. Examples are environments for monitoring, the environment containing Azure DevOps, Key Vault settings etc.</p>
</div>
</li>
<li>
<p>1.1.2. App Environments</p>
<div class="paragraph">
<p>Represents the environments where application is deployed to.</p>
</div>
</li>
<li>
<p>1.1.2.1. Envs</p>
<div class="paragraph">
<p>This level contains all infrastructure code for seting up en environment. The split between dev and non-dev leverages cost savings for less performant dev environments e.g. by picking cheaper service configurations or totally different Azure services.</p>
</div>
</li>
<li>
<p>1.1.2.1.1. Dev</p>
</li>
<li>
<p>1.1.2.1.2. Non-Dev</p>
</li>
<li>
<p>1.1.2.1.3. Modules</p>
<div class="paragraph">
<p>Factored out modules for shared reuse. One example is a central module to generate the name for a given module.</p>
</div>
</li>
<li>
<p>1.1.2.2. Envs-Mgmt</p>
<div class="paragraph">
<p>Captures aspects assumed by the chosen programming language such as terraform for managing an environment. This includes for instance the backend creation code.</p>
</div>
</li>
<li>
<p>1.2. Pipelines</p>
<div class="paragraph">
<p>Pipelines for automating infrastrcuture deployment.</p>
</div>
</li>
<li>
<p>2. App</p>
</li>
<li>
<p>2.1. Application (Black Box)</p>
</li>
<li>
<p>2.2. Pipelines</p>
<div class="paragraph">
<p>Pipelines for automating app code deployment.</p>
</div>
</li>
<li>
<p>3. Shared</p>
<div class="paragraph">
<p>Captures shared aspects between infrastructure and application code such as publishing key vault secrets for a pipeline or triggering another pipeline.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="index.asciidoc_variations">Variations</h3>
<div class="paragraph">
<p>The following features of Azure DevOps can be replaced with alternatives:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Repos</p>
</li>
<li>
<p>Boards for project management</p>
</li>
<li>
<p>Azure Artefacts</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following alternatives on service level exist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/lab-services/">Azure Lab Services</a> for Dev/ Test scenarios</p>
</li>
<li>
<p><a href="https://kubernetes.io">Kubernetes</a></p>
<div class="ulist">
<ul>
<li>
<p>Azure DevSpaces (Deprecated) in favor of “Bridge-to-kubernetes” for Dev/ Test scenarios</p>
</li>
<li>
<p>Bridge-to-Kubernetes</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="index.asciidoc_when-to-use">When to use</h3>
<div class="paragraph">
<p>Azure DevOps makes sense if you want to provision to Azure due to its tight integration into the Azure platform. The following circumstances also speak for Azure DevOps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You need a mature service on enterprise level</p>
</li>
<li>
<p>You don&#8217;t need cloud agnostic pipelines e.g. due to a multi-cloud scenario</p>
</li>
<li>
<p>Your code repository is not GitHub and Azure DevOps provides integrations for it (GitHub Actions are a better alternative if your code repos are already on GitHub.)</p>
</li>
<li>
<p>You need a full blown provisioning service and plan to use the integrated repos that come with Azure DevOps</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="index.asciidoc_credits">Credits</h2>
<div class="sectionbody">
<div class="imageblock" style="text-align: right;">
<div class="content">
<a class="image" href="https://forms.office.com/Pages/ResponsePage.aspx?id=Wq6idgCfa0-V7V0z13xNYal7m2EdcFdNsyBBMUiro4NUNllHQTlPNU9QV1JRRjk3TTAwVUJCNThTRSQlQCN0PWcu"><img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/ms_guild_logo.png" alt="MS Guild Logo" width="160" height="75"></a>
</div>
</div>
</div>
</div>
</div>
<div id="footer" class="footer">
<div class="openblock footerLinks">
<div class="content">
<div class="dlist linklist">
<dl>
<dt class="hdlist1">About</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_introduction.html">About devonfw</a></p>
</li>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_introduction.html#introduction-why-should-i-use-devonfw.asciidoc">Features</a></p>
</li>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_further-information.html">Technology Stack</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Explore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc.html">Getting started</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devon4j.wiki_architecture.asciidoc.html">Architecture</a></p>
</li>
<li>
<p><a href="/website/pages/resources/resources.html">Resources</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Docs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-ide-introduction.asciidoc.html">User guide</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master-release-notes.asciidoc.html">Releases information</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Community</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/orgs/devonfw/people">Contributors</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw.github.io/blob/develop/README.asciidoc">Website Contribution</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="ulist footerFooter">
<ul>
<li>
<p><a href="https://devonfw.com/website/pages/docs/devonfw-ide-support.asciidoc.html#LICENSE.asciidoc">Terms of Use</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw">Support</a></p>
</li>
</ul>
</div>
</div>
    <script>
      let bb = document.getElementById('menu-button');
      bb.addEventListener('click', function() {
        document.querySelector('.website-navbar ul').classList.toggle('visible');
        console.log(document.querySelector('.website-navbar ul'))
      })
    </script>
    <script type="module">
      import { EditLinksModule } from '/website/shared/editlinks.js';

      let alwaysVisible = true;
      if(document.location.pathname.endsWith("pages/welcome/welcome.html")) {
        alwaysVisible = false;
      }
      EditLinksModule.addEditLinks(alwaysVisible);
    </script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
<div class="footnote"><sub>

Last updated 2022-02-10 16:01:14 UTC
</sub></div>
</div>
</div>
<script>
  if(!document.location.pathname.endsWith("pages/welcome/welcome.html")) {
    anchors.options.visible = 'always';
  }
  anchors.add();
</script>
<script>
  var internalUrls = ["https://cginternal.devonfw.com/websitesnippets/"];
  $(".internal").each(function(){
    internalUrls.forEach((internalUrl, index) => {
      $.ajax({url: internalUrl + $(this).text() + "/index.html" })
      .then(r => {
        var leftDiv = $('<div class="info"><span class="infoText">Internal</span><img class="infoImage" src="' + internalUrl + 'logo.png"/></div>');
        var rightFirstDiv = $('<div class="message">This is only visible inside of the corporate network.</div>');
        var rightLastDiv = $('<div class="content"></div>');
        rightLastDiv.html(r);
        var rightDiv = $('<div class="right"></div>');
        rightDiv.append(rightFirstDiv);
        rightDiv.append(rightLastDiv);
        $(this).html(leftDiv);
        $(this).append(rightDiv);
        $(this).addClass("internal-active");
        $(this).removeClass("internal");
      })
    });
	});
</script>
</body>
</html>