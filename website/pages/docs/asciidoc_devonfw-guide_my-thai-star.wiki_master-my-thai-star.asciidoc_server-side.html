<!DOCTYPE html><html lang="en"><head><style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style><style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="Updated at 2022-02-21 15:47:00 UTC">

<!-- ******** SOCIAL MEDIA META ********** -->

<meta name="title" property="og:title" content="devonfw website">
<meta property="og:type" content="website">
<meta name="image" property="og:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="description" property="og:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta property="og:url" content="https://devonfw.com/index.html">

<meta name="twitter:title" content="devonfw website">
<meta name="twitter:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta name="twitter:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="twitter:card" content="summary_large_image">

<!-- ************************************* -->


<title>devonfw guide</title>
<!-- devonfw website stylesheet -->
<link rel="stylesheet" type="text/css" href="/devonfw.css">
<!-- Lunr -->
<script src="/website/assets/scripts/lunr.min.js"></script>
<!-- JQuery -->
<script src="/website/assets/scripts/jquery.min.js"></script>
<link rel="stylesheet" href="/website/assets/styles/font-awesome.min.css">
<link rel="stylesheet" href="/website/assets/styles/googlecode.min.css">
<script src="/website/assets/scripts/highlight.min.js"></script>
<script src="/website/assets/scripts/common.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="/website/assets/styles/bootstrap.min.css">

<script src="/website/assets/scripts/anchor.min.js"></script>

<script src="/website/components/header/search-engine/bundle.js"></script>

<script src="/website/shared/rightmenu.js"></script>

<!-- ************** Google analytics ************ -->
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

gtag('consent', 'default', {
  'analytics_storage': 'denied'
});
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-151636804-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151636804-1');
</script>
<script>
  function consentGranted() {
    gtag('consent', 'update', {
      'analytics_storage': 'granted'
    });
  }
</script>

<!-- ******************************************** -->


<link rel="stylesheet" type="text/css" href="https://cginternal.devonfw.com/websitesnippets/main.css">
<script src="https://cginternal.devonfw.com/websitesnippets/main.js"></script>
</head>
<body id="devonfw-guide_master.asciidoc" class="book toc2 toc-left">
<div id="website-navbar" class="website-navbar">
<button id="menu-button" class="menu-button">
  <img src="/images/menu-button.svg" width="32px" height="32px" alt="">
</button>

<ul>
<li>
<p><span class="image"><a class="image" href="/website/pages/welcome/welcome.html"><img alt="logo" src="/images/Logo_devonfw.svg"></a></span></p>
</li>
<li>
<p><a href="#header_https://www.katacoda.com/devonfw">Tutorials</a></p>
</li>
<li>
<p><a href="/website/pages/solutions/index.html">Solutions</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html" class="active">Docs</a></p>
</li>
</ul>

<form class="form-inline">
  <div class="search-bar">
    <input id="search-field" type="search" class="form-control mr-sm-2" placeholder="Search by keyword(s)..." aria-label="Search" style="height: auto;" autocomplete="off">
    <div class="sb-res-pos px-4">
      <div id="click-outside" class="click-outside z-50 hidden"></div>
      <div class="col rounded px-0 border z-100 bg-white hidden search-bar-results" id="search-results-box">
      </div>
    </div>
  </div>
</form>
<a class="navbar-github text-white" href="https://github.com/devonfw/">
  <img src="/images/github-mark.png" width="auto" height="auto" alt="">
</a></div>
<div id="sidebar" class="wiki-sidebar"></div>

<div id="header">
<h1>devonfw guide</h1>
<div class="details">
<span id="author" class="author">Updated at 2022-02-21 15:54:04 UTC</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="master.html">devonfw guide</a></span></p><ul class="sectlevel0">
<li><a href="devonfw-guide_getting-started.wiki_getting-started.asciidoc.html">Getting Started</a>
</li>
<li><a href="devonfw-guide_ide.wiki_devonfw-ide.asciidoc.html">devonfw-ide</a>
</li>
<li><a href="devonfw-guide_devon4j.wiki_devon4j.asciidoc.html">Java</a>
</li>
<li><a href="devonfw-guide_devon4ng.wiki_master-devon4ng.asciidoc.html">Angular</a>
</li>
<li><a href="devonfw-guide_devon4net.wiki_master-devon4net.asciidoc.html">.net</a>
</li>
<li><a href="devonfw-guide_devon4node.wiki_master-devon4node.asciidoc.html">NodeJS</a>
</li>
<li><a href="devonfw-guide_general_db_master-database.asciidoc.html">Choosing your Database</a>
</li>
<li><a href="devonfw-guide_devonfw-guide_master.asciidoc_2.html">Tools</a>
</li>
<li><a href="devonfw-guide_devonfw-guide_master.asciidoc_3.html">CI/CD</a>
</li>
<li><a href="devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc.html">MyThaiStar</a>
<ul class="sectlevel1">
<li><a href="my-thai-star.wiki_devonfw-guide_my-thai-star.wiki_agile.asciidoc.html">1.	My Thai Star – Agile Framework</a>
</li>
<li><a href="my-thai-star.wiki_devonfw-guide_my-thai-star.wiki_agile.asciidoc_2.html">2.	My Thai Star – Agile Diary</a>
</li>
<li><a href="devonfw-guide_my-thai-star.wiki_User-Stories.asciidoc.html">User Stories</a>
</li>
<li><a href="devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc_technical-design.html">Technical design</a>
<ul class="sectlevel2">
<li><a href="devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc_data-model.html">Data Model</a>
</li>
<li><a href="asciidoc_devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc_server-side.html"><span class="toc-current">Server Side</span></a>
<ul class="sectlevel3">
<li><a href="asciidoc_devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc_server-side.html#devonfw-guide_my-thai-star.wiki_java-design.asciidoc">Java design</a>
</li>
<li><a href="asciidoc_devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc_server-side.html#devonfw-guide_my-thai-star.wiki_net-design.asciidoc">.NET design</a>
</li>
<li><a href="asciidoc_devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc_server-side.html#devonfw-guide_my-thai-star.wiki_nodejs-design.asciidoc">NodeJS design (deprecated)</a>
</li>
<li><a href="asciidoc_devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc_server-side.html#devonfw-guide_my-thai-star.wiki_serverless-design.asciidoc">Serverless design (deprecated)</a>
</li>
<li><a href="asciidoc_devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc_server-side.html#devonfw-guide_my-thai-star.wiki_graphql-design.asciidoc">GraphQL design</a>
</li>
</ul>
</li>
<li><a href="asciidoc_devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc_client-side.html">Client Side</a>
</li>
</ul>
</li>
<li><a href="devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc_security.html">Security</a>
</li>
<li><a href="devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc_testing.html">Testing</a>
</li>
<li><a href="devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc_ui-design.html">UI design</a>
</li>
<li><a href="devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc_cicd.html">CI/CD</a>
</li>
</ul>
</li>
<li><a href="devonfw-guide_general_master-contributing.asciidoc.html">Contributing</a>
</li>
<li><a href="devonfw-guide_general_master-release-notes.asciidoc.html">Release Notes</a>
</li>
</ul>
</div>
</div><div id="content">
<div class="sect2">
<h3 id="asciidoc_devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc_server-side">Server Side</h3>
<!-- toc disabled -->
<div class="sect3">
<h4 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc">Java design</h4>
<div class="sect4">
<h5 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_introduction">Introduction</h5>
<div class="paragraph">
<p>The Java back-end for My Thai Star application is going to be based on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>DEVON4J</strong> as the Java framework</p>
</li>
<li>
<p><strong>Devonfw</strong> as the Development environment</p>
</li>
<li>
<p><strong>CobiGen</strong> as code generation tool</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To know more details about the above technologies please visit the following documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw/devon4j/wiki">DEVON4J</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devon/wiki">Devonfw</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/cobigen/wiki">CobiGen</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_basic-architecture-details">Basic architecture details</h5>
<div class="paragraph">
<p>Following the DEVON4J conventions the Java My Thai Star back-end is going to be developed dividing the application in <em>Components</em> and using a three layers architecture.</p>
</div>
<div class="sect5">
<h6 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_project-modules">Project modules</h6>
<div class="paragraph">
<p>Using the DEVON4J approach for the Java back-end project we will have a structure of a <em>Maven</em> project formed by three projects</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/java/project_modules.png"><img src="images/java/project_modules.png" alt="project modules"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code><em>api</em></code>: Stores all the REST interfaces and corresponding Request/Response objects.</p>
</li>
<li>
<p><em>core</em>: Stores all the logic and functionality of the application.</p>
</li>
<li>
<p><em>server</em>: Configures the packaging of the application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We can automatically generate this project structure <a href="https://github.com/devonfw/devon/wiki/getting-started-creating-new-devonfw-application#running-the-archetype">using the DEVON4J <em>Maven</em> archetype</a></p>
</div>
</div>
<div class="sect5">
<h6 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_components">Components</h6>
<div class="paragraph">
<p>The application is going to be divided in different components to encapsulate the different domains of the application functionalities.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/java/mtsj_components.png"><img src="images/java/mtsj_components.png" alt="mtsj components"></a>
</div>
</div>
<div class="paragraph">
<p>As <em>main components</em> we will find:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><em>Bookingmanagement</em></code>: Manages the bookings part of the application. With this component the users (anonymous/logged in) can create new bookings or cancel an existing booking. The users with waiter role can see all scheduled bookings.</p>
</li>
<li>
<p><code><em>Ordermanagement</em></code>: This component handles the process to order dishes (related to bookings). A user (as a host or as a guest) can create orders (that contain dishes) or cancel an existing one. The users with waiter role can see all ordered orders.</p>
</li>
<li>
<p><code><em>Dishmanagement</em></code>: This component groups the logic related to the menu (dishes) view. Its main feature is to provide the client with the data of the available dishes but also can be used by other components <code>(Ordermanagement)</code> as a data provider in some processes.</p>
</li>
<li>
<p><code><em>Usermanagement</em></code>: Takes care of the User Profile management, allowing to create and update the data profiles.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As <em>common components</em> (that don’t exactly represent an application’s area but provide functionalities that can be used by the <em>main components</em>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><em>Imagemanagement</em></code>: Manages the images of the application. In a first approach the` <em>Dishmanagement</em>` component and the <code><em>Usermanagement</em></code> component will have an image as part of its data. The <code><em>Imagemanagement</em></code> component will expose the functionality to store and retrieve this kind of data.</p>
</li>
<li>
<p><code><em>Mailservice</em></code>: with this service we will provide the functionality for sending email notifications. This is a shared service between different app components such as <code><em>bookingmanagement</em></code> or <code><em>ordercomponent</em></code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Security (will manage the access to the <em>private</em> part of the application using a <code><a href="https://jwt.io/">jwt</a></code> implementation).</p>
</li>
<li>
<p>Twitter integration: planned as a <em>Microservice</em> will provide the twitter integration needed for some specific functionalities of the application.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_layers">Layers</h6>
<div class="ulist">
<ul>
<li>
<p><code><a href="https://github.com/devonfw/devon4j/wiki/guide-service-layer">Service Layer</a></code>: this layer will expose the REST API to exchange information with the client applications.</p>
</li>
<li>
<p><code><a href="https://github.com/devonfw/devon4j/wiki/guide-logic-layer">Logic Layer</a></code>: the layer in charge of hosting the business logic of the application.</p>
</li>
<li>
<p><code><a href="https://github.com/devonfw/devon4j/wiki/guide-dataaccess-layer">Data Access Layer</a></code>: the layer to communicate with the data base.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This architecture is going to be reflected dividing each component of the application in different packages to match those three layers.</p>
</div>
</div>
<div class="sect5">
<h6 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_component-structure">Component structure</h6>
<div class="paragraph">
<p>Each one of the components defined previously are going to be structured using the <em>three-layers</em> architecture. In each case we will have a <em>service</em> package, a <em>logic</em> package and a <code><em>dataaccess</em></code> package to fit the layers definition.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/java/component_structure.png"><img src="images/java/component_structure.png" alt="component structure"></a>
</div>
</div>
</div>
<div class="sect5">
<h6 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_dependency-injection">Dependency injection</h6>
<div class="paragraph">
<p>As it is explained in the <code><a href="https://github.com/devonfw/devon4j/wiki/guide-dependency-injection">devonfw documentation</a></code> we are going to implement the <em>dependency injection</em> pattern basing our solution on <em>Spring</em> and the Java standards: <em>java.inject</em> (JSR330) combined with JSR250.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/java/dependency_injection.png"><img src="images/java/dependency_injection.png" alt="dependency injection"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Separation of API and implementation: Inside each layer we will separate the elements in different packages: <code><em>api</em></code> and <code><em>impl</em></code>. The <code><em>api</em></code> will store the <code><em>interface</em></code> with the methods definition and inside the <code><em>impl</em></code> we will store the class that implements the <code><em>interface</em></code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/java/layer_api_impl.png"><img src="images/java/layer_api_impl.png" alt="layer api impl"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Usage of JSR330: The Java standard set of annotations for <em>dependency injection</em> (<code>@Named</code>, <code>@Inject</code>, <code>@PostConstruct</code>, <code>@PreDestroy</code>, etc.) provides us with all the needed annotations to define our beans and inject them.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Named
public class MyBeanImpl implements MyBean {
  @Inject
  private MyOtherBean myOtherBean;

  @PostConstruct
  public void init() {
    // initialization if required (otherwise omit this method)
  }

  @PreDestroy
  public void dispose() {
    // shutdown bean, free resources if required (otherwise omit this method)
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_layers-communication">Layers communication</h6>
<div class="paragraph">
<p>The connection between layers, to access to the functionalities of each one, will be solved using the <em>dependency injection</em> and the JSR330 annotations.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/java/layers_impl.png"><img src="images/java/layers_impl.png" alt="layers impl"></a>
</div>
</div>
<div class="paragraph">
<p><strong>Connection Service - Logic</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Named("DishmanagementRestService")
public class DishmanagementRestServiceImpl implements DishmanagementRestService {

  @Inject
  private Dishmanagement dishmanagement;

  // use the 'this.dishmanagement' object to access to the functionalities of the logic layer of the component

  ...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Connection Logic - Data Access</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Named
public class DishmanagementImpl extends AbstractComponentFacade implements Dishmanagement {

  @Inject
  private DishDao dishDao;

  // use the 'this.dishDao' to access to the functionalities of the data access layer of the component
  ...

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_service-layer">Service layer</h5>
<div class="paragraph">
<p>The services layer will be solved using REST services with the <a href="https://github.com/devonfw/devon4j/wiki/guide-rest#jax-rs">JAX-RS implementation</a>.</p>
</div>
<div class="paragraph">
<p>To give service to the defined <em>User Stories</em> we will need to implement the following services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>provide all available dishes.</p>
</li>
<li>
<p>save a booking.</p>
</li>
<li>
<p>save an order.</p>
</li>
<li>
<p>provide a list of bookings (only for waiters) and allow filtering.</p>
</li>
<li>
<p>provide a list of orders (only for waiters) and allow filtering.</p>
</li>
<li>
<p>login service (see the <em>Security</em> section).</p>
</li>
<li>
<p>provide the <em>current user</em> data (see the <em>Security</em> section)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Following the <a href="https://github.com/devonfw/devon4j/wiki/guide-rest">naming conventions</a> proposed for <em>Devon4j</em> applications we will define the following <em>end points</em> for the listed services.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(POST) <code>/mythaistar/services/rest/dishmanagement/v1/dish/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/filter</code> (to filter with fields that does not belong to the Order entity).</p>
</li>
<li>
<p>(POST) <code>/mythaistar/login</code>.</p>
</li>
<li>
<p>(GET) <code>/mythaistar/services/rest/security/v1/currentuser/</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find all the details for the services implementation in the <a href="https://github.com/devonfw/my-thai-star/blob/develop/swagger/mythaistar.yaml">Swagger definition</a> included in the My Thai Star project on Github.</p>
</div>
<div class="sect5">
<h6 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_service-api">Service API</h6>
<div class="paragraph">
<p>The <code><em>api.rest</em></code> package in the <em>service</em> layer of a <em>component</em> will store the definition of the service by a  <em>Java interface</em>. In this definition of the service we will set-up the <em>endpoints</em> of the service, the type of data expected and returned, the <em>HTTP</em> method for each endpoint of the service and other configurations if needed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Path("/dishmanagement/v1")
@Consumes(MediaType.APPLICATION_JSON)
@Produces(MediaType.APPLICATION_JSON)
public interface DishmanagementRestService {

  @GET
  @Path("/dish/{id}/")
  public DishCto getDish(@PathParam("id") long id);

  ...

}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_service-impl">Service <code>impl</code></h6>
<div class="paragraph">
<p>Once the service <code><em>api</em></code> is defined we need to implement it using the <em>Java interface</em> as reference. We will add the <em>service implementation</em> class to the <code><em>impl.rest</em></code> package and implement the <code><em>RestService interface</em></code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Named("DishmanagementRestService")
public class DishmanagementRestServiceImpl implements DishmanagementRestService {

  @Inject
  private Dishmanagement dishmanagement;

  @Override
  public DishCto getDish(long id) {
    return this.dishmanagement.findDish(id);
  }

  ...

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can see the Devon4j conventions for REST services <a href="https://github.com/devonfw/devon4j/wiki/guide-rest">here</a>. And the My Thai Star services definition <a href="https://github.com/devonfw/my-thai-star/blob/develop/swagger/mythaistar.yaml">here</a> as part of the <a href="https://github.com/devonfw/my-thai-star">My Thai Star</a> project.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_logic-layer">Logic layer</h5>
<div class="paragraph">
<p>In the <em>logic</em> layer we will locate all the <em>business logic</em> of the application. We will keep the same schema as we have done for the <em>service</em> layer, having an <code><em>api</em></code> package with the definition of the methods and a <code><em>impl</em></code> package for the implementation.</p>
</div>
<div class="paragraph">
<p>Also, inside the <code><em>api</em></code> package, a <em>to</em> package will be the place to store the <code><a href="https://github.com/devonfw/devon4j/wiki/guide-transferobject"><em>transfer objects</em></a></code> needed to pass data through the layers of the component.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/java/logic_layer.png"><img src="images/java/logic_layer.png" alt="logic layer"></a>
</div>
</div>
<div class="paragraph">
<p>The logic <code><em>api</em></code> definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface Dishmanagement {

  DishCto findDish(Long id);

  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The logic <code><em>impl</em></code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Named
public class DishmanagementImpl extends AbstractComponentFacade implements Dishmanagement {

  @Inject
  private DishDao dishDao;


  @Override
  public DishCto findDish(Long id) {

    return getBeanMapper().map(this.dishDao.findOne(id), DishCto.class);
  }

  ...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code><em>BeanMapper</em></code> will provide the needed transformations between <em>entity</em> and <em>transfer objects</em>.</p>
</div>
<div class="paragraph">
<p>Also, the <em>logic</em> layer is the place to add validation for <em>Authorization</em> based on <em>roles</em> as we will see later.</p>
</div>
</div>
<div class="sect4">
<h5 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_data-access-layer">Data Access layer</h5>
<div class="paragraph">
<p>The data-access layer is responsible for managing the connections to access and process data. The mapping between java objects to a relational database is done in <em>Devon4j</em> with the <a href="https://spring.io/projects/spring-data-jpa">spring-data-jpa</a>.</p>
</div>
<div class="paragraph">
<p>As in the previous layers, the <em>data-access</em> layer will have both <code><em>api</em></code> and <code><em>impl</em></code> packages. However, in this case, the implementation will be slightly different. The <code><em>api</em></code> package will store the <em>component</em> main <em>entities and, inside the <code>_api</code></em> package, another <code><em>api.repo</em></code> package will store the Repositories. The <em>repository</em> interface will extend <code>DefaultRepository</code> interface (located in <code>com.devonfw.module.jpa.dataaccess.api.data</code> package of <a href="http://repo1.maven.org/maven2/com/devonfw/java/starters/devon4j-starter-spring-data-jpa/3.0.0/">devon4j-starter-spring-data-jpa</a> ).</p>
</div>
<div class="paragraph">
<p>For queries we will differentiate between <em>static queries</em> (that will be located in a mapped file) and <em>dynamic queries</em> (implemented with <a href="http://www.querydsl.com/">QueryDsl</a>). You can find all the details about how to manage queries with <em>Devon4j</em> <a href="https://github.com/devonfw/devon4j/wiki/guide-jpa-query">here</a>.</p>
</div>
<div class="paragraph">
<p>The default data base included in the project will be the <a href="http://www.h2database.com/html/main.html">H2</a> instance included with the <em>Devon4j</em> projects.</p>
</div>
<div class="paragraph">
<p>To get more details about <em>pagination</em>, <em>data base security, _concurrency control</em>, <em>inheritance</em> or how to solve the different <em>relationships</em> between entities visit the official <code><a href="https://github.com/devonfw/devon4j/wiki/guide-dataaccess-layer">devon4j dataaccess documentation</a></code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_security-with-json-web-token">Security with Json Web Token</h5>
<div class="paragraph">
<p>For the <em>Authentication</em> and <em>Authorization</em> the app will implement the <code><a href="https://jwt.io/">json web token</a></code> protocol.</p>
</div>
<div class="sect5">
<h6 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_jwt-basics">JWT basics</h6>
<div class="ulist">
<ul>
<li>
<p>A user will provide a username / password combination to our Auth server.</p>
</li>
<li>
<p>The Auth server will try to identify the user and, if the credentials match, will issue a token.</p>
</li>
<li>
<p>The user will send the token as the <em>Authorization</em> header to access resources on server protected by JWT Authentication.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/java/jwt_schema.png"><img src="images/java/jwt_schema.png" alt="jwt schema"></a>
</div>
</div>
</div>
<div class="sect5">
<h6 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_jwt-implementation-details">JWT implementation details</h6>
<div class="paragraph">
<p>The <em>Json Web Token</em> pattern will be implemented based on the <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/reference/htmlsingle/"><em>Spring Security</em></a> framework that is provided by default in the <em>Devon4j</em> projects.</p>
</div>
<div class="sect6">
<h7 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_authentication">Authentication</h7>
<div class="paragraph">
<p>Based on the <em>Spring Security</em> approach, we will implement a class extending <code><em>WebSecurityConfigurerAdapter</em></code> (<em>Devon4j</em> already provides the` <em>BaseWebSecurityConfig</em>` class) to define the security <em>entry point</em> and filters. Also, as <em>My Thai Star</em> is a mainly <em>public</em> application, we will define here the resources that won’t be secured.</p>
</div>
<div class="paragraph">
<p>List of <em>unsecured resources</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><em>/services/rest/dishmanagement/**</em></code>: to allow anonymous users to see the dishes info in the <em>menu</em> section.</p>
</li>
<li>
<p><code><em>/services/rest/ordermanagement/v1/order</em></code>: to allow anonymous users to save an order. They will need a <em>booking token</em> but they won’t be authenticated to do this task.</p>
</li>
<li>
<p><code><em>/services/rest/bookingmanagement/v1/booking</em></code>: to allow anonymous users to create a booking. Only a <em>booking token</em> is necessary to accomplish this task.</p>
</li>
<li>
<p><code><em>/services/rest/bookingmanagement/v1/booking/cancel/**</em></code>: to allow canceling a booking from an email. Only the <em>booking token</em> is needed.</p>
</li>
<li>
<p><code><em>/services/rest/bookingmanagement/v1/invitedguest/accept/**</em></code>: to allow guests to accept an invite. Only a <em>guest token</em> is needed.</p>
</li>
<li>
<p><code><em>/services/rest/bookingmanagement/v1/invitedguest/decline/**</em></code>: to allow guests to reject an invite. Only a <em>guest token</em> is needed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To configure the <em>login</em> we will set up the <code><em>HttpSecurity</em></code> object in the <em>configure</em> method of the class. We will define a <code><em>JWTLoginFilter</em></code> class that will handle the requests to the <code>/login</code> <em>endpoint</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">http.[...].antMatchers(HttpMethod.POST, "/login").permitAll().[...].addFilterBefore(new JWTLoginFilter("/login", authenticationManager()), UsernamePasswordAuthenticationFilter.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the same <code><em>HttpSecurity</em></code> object we will set up the filter for the rest of the requests, to check the presence of the JWT token in the header. First we will need to create a <code><em>JWTAuthenticationFilter</em></code> class extending the <code><em>GenericFilterBean</em></code> class. Then we can add the filter to the <code><em>HttpSecurity</em></code> object</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">http.[...].addFilterBefore(new `JWTAuthenticationFilter()`, UsernamePasswordAuthenticationFilter.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, as default users to start using the <em>My Thai Star</em> app we are going to define two profiles using the <code><em>inMemoryAuthentication</em></code> of the <em>Spring Security</em> framework. In the <code>configure(AuthenticationManagerBuilder Auth)</code> method we will create:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>user: <em>waiter</em></p>
</li>
<li>
<p>password: <em>waiter</em></p>
</li>
<li>
<p>role: <em>Waiter</em></p>
</li>
<li>
<p>user: <em>user0</em></p>
</li>
<li>
<p>password: <em>password</em></p>
</li>
<li>
<p>role: <em>Customer</em></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">auth.inMemoryAuthentication().withUser("waiter").password("waiter").roles("Waiter").and().withUser("user0").password("password").roles("Customer");</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_token-set-up">Token set up</h7>
<div class="paragraph">
<p>Following the <code><a href="https://jwt.io/introduction/">official documentation</a></code> the implementation details for the MyThaiStar’s JWT will be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Secret</em>: Used as part of the signature of the token, acting as a private key. For the showcase purposes we will use simply <code>"ThisIsASecret"</code>.</p>
</li>
<li>
<p><em>Token Prefix</em> schema: Bearer. The token will look like <code>Bearer &lt;token&gt;</code></p>
</li>
<li>
<p><em>Header</em>: Authorization. The response header where the token will be included. Also, in the requests, when checking the token it will be expected to be in the same header.</p>
</li>
<li>
<p>The <em>Authorization</em> header should be part of the <code>Access-Control-Expose-Headers</code> header to allow clients access to the <em>Authorization</em> header content (the token);</p>
</li>
<li>
<p>The <em>claims</em> are the content of the <em>payload</em> of the token. The <em>claims</em> are statements about the user, so we will include the user info in this section.</p>
<div class="ulist">
<ul>
<li>
<p><em>subject</em>: "sub". The username.</p>
</li>
<li>
<p><em>issuer</em>: <code>"iss"</code>. Who creates the token. We could use the <code><em>url</em></code> of our service but, as this is a showcase app, we simply will use <code>"MyThaiStarApp"</code></p>
</li>
<li>
<p><em>expiration date</em>: "exp". Defines when the token expires.</p>
</li>
<li>
<p><em>creation date</em>: <code>"iat"</code>. Defines when the token has been created.</p>
</li>
<li>
<p><em>scope</em>: "scope". Array of strings to store the user roles.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Signature Algorithm: To encrypt the token we will use the default algorithm HS512.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example of a token claims before encryption would be:</p>
</div>
<div class="paragraph">
<p><code>{sub=waiter, scope=[ROLE_Waiter], iss=MyThaiStarApp, exp=1496920280, iat=1496916680}</code></p>
</div>
</div>
<div class="sect6">
<h7 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_current-user-request">Current User request</h7>
<div class="paragraph">
<p>To provide to the client with the current user data our application should expose a service to return the user details. In <em>Devon4j</em> applications the <code>/general/service/impl/rest/SecurityRestServiceImpl.java</code> class is ready to do that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Path("/security/v1")
@Named("SecurityRestService")
public class SecurityRestServiceImpl {

  @Produces(MediaType.APPLICATION_JSON)
  @GET
  @Path("/currentuser/")
  public UserDetailsClientTo getCurrentUserDetails(@Context HttpServletRequest request) {

  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>we only will need to implement the <code>getCurrentUserDetails</code> method.</p>
</div>
</div>
<div class="sect6">
<h7 id="devonfw-guide_my-thai-star.wiki_java-design.asciidoc_authorization">Authorization</h7>
<div class="paragraph">
<p>We need to secure three services, that only should be accessible for users with role <em>Waiter</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/filter</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As part of the token we are providing the user <em>Role</em>. So, when validating the token, we can obtain that same information and build a <code>UsernamePasswordAuthenticationToken</code> with username and the roles as collection of <em>Granted Authorities</em>.</p>
</div>
<div class="paragraph">
<p>Doing so, afterwards, in the implementation class of the <em>logic</em> layer we can set up the related methods with the <em>java security</em> <code>'@RolesAllowed'</code> annotation to block the access to the resource to users that does not match the expected roles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">`@RolesAllowed(Roles.WAITER)`
public PaginatedListTo&lt;BookingEto&gt; findBookings(BookingSearchCriteriaTo criteria) {
  return findBookings(criteria);
}</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_my-thai-star.wiki_net-design.asciidoc">.NET design</h4>
<div class="paragraph">
<p>TODO</p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="devonfw-guide_my-thai-star.wiki_nodejs-design.asciidoc">NodeJS design (deprecated)</h4>
<div class="sect4">
<h5 id="devonfw-guide_my-thai-star.wiki_nodejs-design.asciidoc_introduction">Introduction</h5>
<div class="paragraph">
<p>The NodeJS back-end for My Thai Star application is going to be based on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ExpressJS</strong> as the web application framework</p>
</li>
<li>
<p><strong>devon4node</strong> as data access layer framework</p>
</li>
<li>
<p><strong>DynamoDB</strong> as NoSQL Database</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To know more details about the above technologies please visit the following documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://expressjs.com">ExpressJS</a></p>
</li>
<li>
<p><a href="https://devonfw.com/website/pages/docs/master-devon4node.asciidoc.html">devon4node</a></p>
</li>
<li>
<p><a href="https://aws.amazon.com/dynamodb/developer-resources/">DynamoDB</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devonfw-guide_my-thai-star.wiki_nodejs-design.asciidoc_basic-architecture-details">Basic architecture details</h5>
<div class="paragraph">
<p>This structure can be shown in the following example image:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/nodejs/folder_organization.png"><img src="images/nodejs/folder_organization.png" alt="folder organization"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>public - All files which be exposed on the server directly</p>
</li>
<li>
<p><code>src</code></p>
<div class="ulist">
<ul>
<li>
<p>database folder - Folder with scripts to create/delete/seed the database</p>
</li>
<li>
<p>model - Folder with all data model</p>
</li>
<li>
<p>routes - Folder with all ExpressJS routers</p>
</li>
<li>
<p>utils - Folder with all utils like classes and functions</p>
</li>
<li>
<p><em>app.ts</em> - File with ExpressJS declaration</p>
</li>
<li>
<p><em>config.ts</em> - File with server configs</p>
</li>
<li>
<p><em>logic.ts</em> - File with the business logic</p>
</li>
</ul>
</div>
</li>
<li>
<p>test - Folder with all tests</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devonfw-guide_my-thai-star.wiki_nodejs-design.asciidoc_layers">Layers</h5>
<div class="ulist">
<ul>
<li>
<p>Service Layer: this layer will expose the REST API to exchange information with the client applications.</p>
</li>
<li>
<p>Logic Layer: the layer in charge of hosting the business logic of the application.</p>
</li>
<li>
<p>Data Access Layer: the layer to communicate with the data base.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="devonfw-guide_my-thai-star.wiki_nodejs-design.asciidoc_service-layer">Service layer</h6>
<div class="paragraph">
<p>The services layer will be solved using REST services with <a href="https://expressjs.com">ExpressJS</a></p>
</div>
<div class="paragraph">
<p>To give service to the defined <em>User Stories</em> we will need to implement the following services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>provide all available dishes.</p>
</li>
<li>
<p>save a booking.</p>
</li>
<li>
<p>save an order.</p>
</li>
<li>
<p>provide a list of bookings (only for waiters) and allow filtering.</p>
</li>
<li>
<p>provide a list of orders (only for waiters) and allow filtering.</p>
</li>
<li>
<p>login service (see the <em>Security</em> section).</p>
</li>
<li>
<p>provide the <em>current user</em> data (see the <em>Security</em> section)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to be compatible with the other back-end implementations, we must follow the <code><a href="https://github.com/devonfw/devon4j/wiki/guide-rest">naming conventions</a></code> proposed for <em>Devon4j</em> applications. We will define the following <em>end points</em> for the listed services.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(POST) <code>/mythaistar/services/rest/dishmanagement/v1/dish/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/filter</code> (to filter with fields that does not belong to the Order entity).</p>
</li>
<li>
<p>(POST) <code>/mythaistar/login</code>.</p>
</li>
<li>
<p>(GET) <code>/mythaistar/services/rest/security/v1/currentuser/</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find all the details for the services implementation in the <a href="https://github.com/devonfw/my-thai-star/blob/develop/swagger/mythaistar.yaml">Swagger definition</a> included in the My Thai Star project on Github.</p>
</div>
<div class="paragraph">
<p>To treat these services separately, the following routers were created:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bookingmanagement</code>: will answer all requests with the prefix <code>/mythaistar/services/rest/bookingmanagement/v1</code></p>
</li>
<li>
<p><code>dishmanagement</code>: will answer all requests with the prefix <code>/mythaistar/services/rest/dishmanagement/v1</code></p>
</li>
<li>
<p><code>ordermanagement</code>: will answer all requests with the prefix <code>/mythaistar/services/rest/ordermanagement/v1</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These routers will define the behavior for each service and use the logical layer.</p>
</div>
<div class="paragraph">
<p>An example of service definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JavaScript" data-lang="JavaScript">router.post('/booking/search', (req: types.CustomRequest, res: Response) =&gt; {
    try {
        // body content must be SearchCriteria
        if (!types.isSearchCriteria(req.body)) {
            throw {code: 400, message: 'No booking token given' };
        }

        // use the searchBooking method defined at business logic
        business.searchBooking(req.body, (err: types.Error | null, bookingEntity: types.PaginatedList) =&gt; {
            if (err) {
                res.status(err.code || 500).json(err.message);
            } else {
                res.json(bookingEntity);
            }
        });
    } catch (err) {
        res.status(err.code || 500).json({ message: err.message });
    }
});</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="devonfw-guide_my-thai-star.wiki_nodejs-design.asciidoc_logic-layer-and-data-access-layer">Logic layer and Data access layer</h6>
<div class="paragraph">
<p>In the <em>logic</em> layer we will locate all the <em>business logic</em> of the application. It will be located in the file logic.ts. If in this layer we need to get access to the data, we make use of data access layer directly, in this case using devon4node with the DynamoDB adapter.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JavaScript" data-lang="JavaScript">export async function cancelOrder(orderId: string, callback: (err: types.Error | null) =&gt; void) {
    let order: dbtypes.Order;

    try {
        // Data access
        order = await oasp4fn.table('Order', orderId).promise() as dbtypes.Order;

        [...]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We could define the data access layer separately, but devon4node allows us to do this in a simple and clear way. So, we decided  to not separate the access layer to the logic business.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="devonfw-guide_my-thai-star.wiki_nodejs-design.asciidoc_security-with-json-web-token">Security with Json Web Token</h5>
<div class="paragraph">
<p>For the <em>Authentication</em> and <em>Authorization</em> the app will implement the <code><a href="https://jwt.io/">json web token</a></code> protocol.</p>
</div>
<div class="sect5">
<h6 id="devonfw-guide_my-thai-star.wiki_nodejs-design.asciidoc_jwt-basics">JWT basics</h6>
<div class="paragraph">
<p>Refer to <a href="asciidoc_devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc_server-side.html#devonfw-guide_my-thai-star.wiki_java-design.asciidoc_jwt-basics">JWT basics</a> for more information.</p>
</div>
</div>
<div class="sect5">
<h6 id="devonfw-guide_my-thai-star.wiki_nodejs-design.asciidoc_jwt-implementation-details">JWT implementation details</h6>
<div class="paragraph">
<p>The <em>Json Web Token</em> pattern will be implemented based on the <code><a href="https://github.com/auth0/node-jsonwebtoken"><em>JSON web token</em></a></code> library available on npm.</p>
</div>
<div class="sect6">
<h7 id="devonfw-guide_my-thai-star.wiki_nodejs-design.asciidoc_authentication">Authentication</h7>
<div class="paragraph">
<p>Based on the <em>JSON web token</em> approach, we will implement a class <em>Authentication</em> to define the security <em>entry point</em> and filters. Also, as <em>My Thai Star</em> is a mainly <em>public</em> application, we will define here the resources that won’t be secured.</p>
</div>
<div class="paragraph">
<p>List of <em>unsecured resources</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><em>/services/rest/dishmanagement/\**</em></code>: to allow anonymous users to see the dishes info in the <em>menu</em> section.</p>
</li>
<li>
<p><code><em>/services/rest/ordermanagement/v1/order</em></code>: to allow anonymous users to save an order. They will need a <em>booking token</em> but they won’t be authenticated to do this task.</p>
</li>
<li>
<p><code><em>/services/rest/bookingmanagement/v1/booking</em></code>: to allow anonymous users to create a booking. Only a <em>booking token</em> is necessary to accomplish this task.</p>
</li>
<li>
<p><code><em>/services/rest/bookingmanagement/v1/booking/cancel/\**</em></code>: to allow canceling a booking from an email. Only the <em>booking token</em> is needed.</p>
</li>
<li>
<p><code><em>/services/rest/bookingmanagement/v1/invitedguest/accept/\**</em></code>: to allow guests to accept an invite. Only a <em>guest token</em> is needed.</p>
</li>
<li>
<p><code><em>/services/rest/bookingmanagement/v1/invitedguest/decline/\**</em></code>: to allow guests to reject an invite. Only a <em>guest token</em> is needed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To configure the <em>login</em> we will create an instance of <em>Authentication</em> in the app file and then we will use the method <code><em>auth</em></code> for handle the requests to the /login endpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JavaScript" data-lang="JavaScript">app.post('/mythaistar/login', auth.auth);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To verify the presence of the <em>Authorization token</em> in the headers, we will register in the express the <code><em>Authentication.registerAuthentication</em></code> middleware. This middleware will check if the token is correct, if so, it will place the user in the request and continue to process it. If the token is not correct it will continue processing the request normally.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JavaScript" data-lang="JavaScript">app.use(auth.registerAuthentication);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we have two default users created in the database:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>user: <em>waiter</em></p>
</li>
<li>
<p>password: <em>waiter</em></p>
</li>
<li>
<p>role: <em>WAITER</em></p>
</li>
<li>
<p>user: <em>user0</em></p>
</li>
<li>
<p>password: <em>password</em></p>
</li>
<li>
<p>role: <em>CUSTOMER</em></p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="devonfw-guide_my-thai-star.wiki_nodejs-design.asciidoc_token-set-up">Token set up</h7>
<div class="paragraph">
<p>Following <code>the <a href="https://jwt.io/introduction/">official documentation</a></code> the implementation details for the MyThaiStar’s JWT will be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Secret</em>: Used as part of the signature of the token, acting as a private key. It can be modified at config.ts file.</p>
</li>
<li>
<p><em>Token Prefix</em> schema: Bearer. The token will look like <code>Bearer &lt;token&gt;</code></p>
</li>
<li>
<p><em>Header</em>: Authorization. The response header where the token will be included. Also, in the requests, when checking the token it will be expected to be in the same header.</p>
</li>
<li>
<p>The <em>Authorization</em> header should be part of the <code>Access-Control-Expose-Headers</code> header to allow clients access to the <em>Authorization</em> header content (the token);</p>
</li>
<li>
<p>Signature Algorithm: To encrypt the token we will use the default algorithm HS512.</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="devonfw-guide_my-thai-star.wiki_nodejs-design.asciidoc_current-user-request">Current User request</h7>
<div class="paragraph">
<p>To provide to the client with the current user data our application should expose a service to return the user details. In this case the <em>Authentication</em> has a method called <code><em>getCurrentUser</em></code> which will return the user data. We only need register it at express.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JavaScript" data-lang="JavaScript">app.get('/mythaistar/services/rest/security/v1/currentuser', auth.getCurrentUser);</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="devonfw-guide_my-thai-star.wiki_nodejs-design.asciidoc_authorization">Authorization</h7>
<div class="paragraph">
<p>We need to secure three services, that only should be accessible for users with role <em>Waiter</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/filter</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To ensure this, the <em>Authorization</em> class has the <code><em>securizedEndpoint</em></code> method that guarantees access based on the role. This method can be used as middleware in secure services. As the role is included in the token, once validated we will have this information in the request and the middleware can guarantee access or return a 403 error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JavaScript" data-lang="JavaScript">app.use('/mythaistar/services/rest/ordermanagement/v1/order/filter', auth.securizedEndpoint('WAITER'));
app.use('/mythaistar/services/rest/ordermanagement/v1/order/search', auth.securizedEndpoint('WAITER'));
app.use('/mythaistar/services/rest/bookingmanagement/v1/booking/search', auth.securizedEndpoint('WAITER'));</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_my-thai-star.wiki_serverless-design.asciidoc">Serverless design (deprecated)</h4>
<div class="sect4">
<h5 id="devonfw-guide_my-thai-star.wiki_serverless-design.asciidoc_introduction">Introduction</h5>
<div class="paragraph">
<p>The NodeJS back-end for My Thai Star application is going to be based on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Serverless</strong> as serverless framework</p>
</li>
<li>
<p><strong>devon4node</strong> as data access layer framework</p>
</li>
<li>
<p><strong>DynamoDB</strong> as NoSQL Database</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To know more details about the above technologies please visit the following documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://serverless.com/">Serverless</a></p>
</li>
<li>
<p><a href="https://devonfw.com/website/pages/docs/master-devon4node.asciidoc.html">devon4node</a></p>
</li>
<li>
<p><a href="https://aws.amazon.com/dynamodb/developer-resources/">DynamoDB</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devonfw-guide_my-thai-star.wiki_serverless-design.asciidoc_basic-architecture-details">Basic architecture details</h5>
<div class="paragraph">
<p>This structure can be shown in the following example image:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/serverless/folder_organization.png"><img src="images/serverless/folder_organization.png" alt="folder organization"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>handlers - All function handlers following devon4node structure</p>
</li>
<li>
<p><code>src</code></p>
<div class="ulist">
<ul>
<li>
<p>model - Folder with all data model</p>
</li>
<li>
<p>utils - Folder with all utils like classes and functions</p>
</li>
<li>
<p><em>config.ts</em> - File with server configs</p>
</li>
<li>
<p><em>logic.ts</em> - File with the business logic</p>
</li>
</ul>
</div>
</li>
<li>
<p>test - Folder with all tests</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devonfw-guide_my-thai-star.wiki_serverless-design.asciidoc_layers">Layers</h5>
<div class="ulist">
<ul>
<li>
<p>Service Layer: this layer will expose the REST API to exchange information with the client applications.</p>
</li>
<li>
<p>Logic Layer: the layer in charge of hosting the business logic of the application.</p>
</li>
<li>
<p>Data Access Layer: the layer to communicate with the data base.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="devonfw-guide_my-thai-star.wiki_serverless-design.asciidoc_service-layer">Service layer</h6>
<div class="paragraph">
<p>The services layer will be solved using REST services with <a href="https://serverless.com/">Serverless</a></p>
</div>
<div class="paragraph">
<p>To give service to the defined <em>User Stories</em> we will need to implement the following services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>provide all available dishes.</p>
</li>
<li>
<p>save a booking.</p>
</li>
<li>
<p>save an order.</p>
</li>
<li>
<p>provide a list of bookings (only for waiters) and allow filtering.</p>
</li>
<li>
<p>provide a list of orders (only for waiters) and allow filtering.</p>
</li>
<li>
<p>login service (see the <em>Security</em> section).</p>
</li>
<li>
<p>provide the <em>current user</em> data (see the <em>Security</em> section)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to be compatible with the other back-end implementations, we must follow the <a href="https://github.com/devonfw/devon4j/wiki/guide-rest">naming conventions</a> proposed for <em>Devon4j</em> applications. We will define the following <em>end points</em> for the listed services.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(POST) <code>/mythaistar/services/rest/dishmanagement/v1/dish/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/filter</code> (to filter with fields that does not belong to the Order entity).</p>
</li>
<li>
<p>(POST) <code>/mythaistar/login</code>.</p>
</li>
<li>
<p>(GET) <code>/mythaistar/services/rest/security/v1/currentuser/</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find all the details for the services implementation in the <a href="https://github.com/devonfw/my-thai-star/blob/develop/swagger/mythaistar.yaml">Swagger definition</a> included in the My Thai Star project on Github.</p>
</div>
<div class="paragraph">
<p>To treat these Http services, we must define the handlers following the <a href="https://devonfw.com/website/pages/docs/master-devon4node.asciidoc.html">devon4node convention</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(handlers/Http/POST/dish-search-handler) <code>/mythaistar/services/rest/dishmanagement/v1/dish/search</code>.</p>
</li>
<li>
<p>(handlers/Http/POST/booking-handler) <code>/mythaistar/services/rest/bookingmanagement/v1/booking</code>.</p>
</li>
<li>
<p>(handlers/Http/POST/order-handler) <code>/mythaistar/services/rest/ordermanagement/v1/order</code>.</p>
</li>
<li>
<p>(handlers/Http/POST/booking-search-handler) <code>/mythaistar/services/rest/bookingmanagement/v1/booking/search</code>.</p>
</li>
<li>
<p>(handlers/Http/POST/order-search-handler) <code>/mythaistar/services/rest/ordermanagement/v1/order/search</code>.</p>
</li>
<li>
<p>(handlers/Http/POST/order-filter-handler) <code>/mythaistar/services/rest/ordermanagement/v1/order/filter</code> (to filter with fields that does not belong to the Order entity).</p>
</li>
<li>
<p>(handlers/Http/POST/login-handler) <code>/mythaistar/login</code>.</p>
</li>
<li>
<p>(handlers/Http/GET/current-user-handler) <code>/mythaistar/services/rest/security/v1/currentuser/</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These handlers will define the behavior for each service and use the logical layer.</p>
</div>
<div class="paragraph">
<p>An example of handler definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JavaScript" data-lang="JavaScript">oasp4fn.config({ path: '/mythaistar/services/rest/bookingmanagement/v1/booking/search' });
export async function bookingSearch(event: HttpEvent, context: Context, callback: Function) {
    try {
        const search = &lt;types.SearchCriteria&gt;event.body;
        const authToken = event.headers.Authorization;
        // falta lo que viene siendo comprobar el token y eso

        auth.decode(authToken, (err, decoded) =&gt; {
            if (err || decoded.role !== 'WAITER') {
                throw { code: 403, message: 'Forbidden'};
            }

            // body content must be SearchCriteria
            if (!types.isSearchCriteria(search)) {
                throw { code: 400, message: 'No booking token given' };
            }

            business.searchBooking(search, (err: types.Error | null, bookingEntity: types.PaginatedList) =&gt; {
                if (err) {
                    callback(new Error(`[${err.code || 500}] ${err.message}`));
                } else {
                    callback(null, bookingEntity);
                }
            });
        });
    } catch (err) {
        callback(new Error(`[${err.code || 500}] ${err.message}`));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default integration for a handler is <em>lambda</em>. See <a href="https://github.com/devonfw/devon4node/wiki/guides-configuration-module">devon4node documentation</a> for more information about default values and how to change it.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you change the integration to lambda-proxy, you must take care that in this case the data will not be parsed. You must do JSON.parse explicitly</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>After defining all the handlers, we must execute the <em>fun</em> command, which will generate the files serverless.yml and <code>webpack.config.js</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="devonfw-guide_my-thai-star.wiki_serverless-design.asciidoc_logic-layer-and-data-access-layer">Logic layer and Data access layer</h6>
<div class="paragraph">
<p><a href="#devonfw-guide_my-thai-star.wiki_NodeJS-design.asciidoc_logic-layer-and-data-access-layer">See in NodeJS section</a></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="devonfw-guide_my-thai-star.wiki_serverless-design.asciidoc_security-with-json-web-token">Security with Json Web Token</h5>
<div class="paragraph">
<p>For the <em>Authentication</em> and <em>Authorization</em> the app will implement the <a href="https://jwt.io/">json web token</a> protocol.</p>
</div>
<div class="sect5">
<h6 id="devonfw-guide_my-thai-star.wiki_serverless-design.asciidoc_jwt-basics">JWT basics</h6>
<div class="paragraph">
<p>Refer to <a href="asciidoc_devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc_server-side.html#devonfw-guide_my-thai-star.wiki_java-design.asciidoc_jwt-basics">JWT basics</a> for more information.</p>
</div>
</div>
<div class="sect5">
<h6 id="devonfw-guide_my-thai-star.wiki_serverless-design.asciidoc_jwt-implementation-details">JWT implementation details</h6>
<div class="paragraph">
<p>The <em>Json Web Token</em> pattern will be implemented based on the <a href="https://github.com/auth0/node-jsonwebtoken"><em>JSON web token</em></a> library available on npm.</p>
</div>
<div class="sect6">
<h7 id="devonfw-guide_my-thai-star.wiki_serverless-design.asciidoc_authentication">Authentication</h7>
<div class="paragraph">
<p>Based on the <em>JSON web token</em> approach, we will implement two methods in order to verify and user + generate the token and decode the token + return the user data. Also, as <em>My Thai Star</em> is a mainly <em>public</em> application, we will define here the resources that won’t be secured.</p>
</div>
<div class="paragraph">
<p>List of <em>unsecured resources</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><em>/services/rest/dishmanagement/**</em></code>: to allow anonymous users to see the dishes info in the <em>menu</em> section.</p>
</li>
<li>
<p><code><em>/services/rest/ordermanagement/v1/order</em></code>: to allow anonymous users to save an order. They will need a <em>booking token</em> but they won’t be authenticated to do this task.</p>
</li>
<li>
<p><code><em>/services/rest/bookingmanagement/v1/booking</em></code>: to allow anonymous users to create a booking. Only a <em>booking token</em> is necessary to accomplish this task.</p>
</li>
<li>
<p><code><em>/services/rest/bookingmanagement/v1/booking/cancel/**</em></code>: to allow canceling a booking from an email. Only the <em>booking token</em> is needed.</p>
</li>
<li>
<p><code><em>/services/rest/bookingmanagement/v1/invitedguest/accept/**</em></code>: to allow guests to accept an invite. Only a <em>guest token</em> is needed.</p>
</li>
<li>
<p><code><em>/services/rest/bookingmanagement/v1/invitedguest/decline/**</em></code>: to allow guests to reject an invite. Only a <em>guest token</em> is needed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To configure the <em>login</em> we will create a handler called login and then we will use the method <em>code</em> to verify the user and generate the token.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JavaScript" data-lang="JavaScript">app.post(oasp4fn.config({ integration: 'lambda-proxy', path: '/mythaistar/login' });
export async function login(event: HttpEvent, context: Context, callback: Function) {
.
.
.
.
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have two default users created in the database:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>user: <em>waiter</em></p>
</li>
<li>
<p>password: <em>waiter</em></p>
</li>
<li>
<p>role: <em>WAITER</em></p>
</li>
<li>
<p>user: <em>user0</em></p>
</li>
<li>
<p>password: <em>password</em></p>
</li>
<li>
<p>role: <em>CUSTOMER</em></p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="devonfw-guide_my-thai-star.wiki_serverless-design.asciidoc_token-set-up">Token set up</h7>
<div class="paragraph">
<p><a href="#devonfw-guide_my-thai-star.wiki_NodeJS-design.asciidoc_token-set-up">See in NodeJS section</a></p>
</div>
</div>
<div class="sect6">
<h7 id="devonfw-guide_my-thai-star.wiki_serverless-design.asciidoc_current-user-request">Current User request</h7>
<div class="paragraph">
<p>To provide the client with the current user data our application should expose a service to return the user details. In order to do this, we must define a handler called current-user-handler. This handler must decode the <em>Authorization token</em> and return the user data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JavaScript" data-lang="JavaScript">oasp4fn.config({
    path: '/mythaistar/services/rest/security/v1/currentuser',
});
export async function currentUser(event: HttpEvent, context: Context, callback: Function) {
    let authToken = event.headers.Authorization;
    try {
        auth.decode(authToken, (err: any, decoded?: any) =&gt; {
            if (err) {
                callback(new Error(`[403] Forbidden`));
            } else {
                callback(null, decoded);
            }
        });
    } catch (err) {
        callback(new Error(`[${err.code || 500}] ${err.message}`));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="devonfw-guide_my-thai-star.wiki_serverless-design.asciidoc_authorization">Authorization</h7>
<div class="paragraph">
<p>We need to secure three services, that only should be accessible for users with role <em>Waiter</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/filter</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To ensure this, we must decode the <em>Authorization token</em> and check the result. As the role is included in the token, once validated we will have this information and can guarantee access or return a 403 error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JavaScript" data-lang="JavaScript">oasp4fn.config({ path: '/mythaistar/services/rest/bookingmanagement/v1/booking/search' });
export async function bookingSearch(event: HttpEvent, context: Context, callback: Function) {
    const authToken = event.headers.Authorization;
    auth.decode(authToken, (err, decoded) =&gt; {
        try {
            if (err || decoded.role !== 'WAITER') {
                throw { code: 403, message: 'Forbidden' };
            }

            [...]

        } catch (err) {
            callback(new Error(`[${err.code || 500}] ${err.message}`));
        }
    });
}</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_my-thai-star.wiki_graphql-design.asciidoc">GraphQL design</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>←&nbsp;Previous:&nbsp;<a href="devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc_data-model.html">Data Model</a>&nbsp;| ↑&nbsp;Up:&nbsp;<a href="devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc_technical-design.html">Technical design</a>&nbsp;| ⌂&nbsp;Home:&nbsp;<a href="master.html">devonfw guide</a>&nbsp;| Next:&nbsp;<a href="asciidoc_devonfw-guide_my-thai-star.wiki_master-my-thai-star.asciidoc_client-side.html">Client Side</a>&nbsp;→</p>
</div>
</div>
<div id="footer" class="footer">
<div class="openblock footerLinks">
<div class="content">
<div class="dlist linklist">
<dl>
<dt class="hdlist1">About</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_introduction.html">About devonfw</a></p>
</li>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_introduction.html#introduction-why-should-i-use-devonfw.asciidoc">Features</a></p>
</li>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_further-information.html">Technology Stack</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Explore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc.html">Getting started</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devon4j.wiki_architecture.asciidoc.html">Architecture</a></p>
</li>
<li>
<p><a href="/website/pages/resources/resources.html">Resources</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Docs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-ide-introduction.asciidoc.html">User guide</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master-release-notes.asciidoc.html">Releases information</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Community</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/orgs/devonfw/people">Contributors</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw.github.io/blob/develop/README.asciidoc">Website Contribution</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="ulist footerFooter">
<ul>
<li>
<p><a href="https://devonfw.com/website/pages/docs/devonfw-ide-support.asciidoc.html#LICENSE.asciidoc">Terms of Use</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw">Support</a></p>
</li>
</ul>
</div>
</div>
    <script>
      let bb = document.getElementById('menu-button');
      bb.addEventListener('click', function() {
        document.querySelector('.website-navbar ul').classList.toggle('visible');
        console.log(document.querySelector('.website-navbar ul'))
      })
    </script>
    <script type="module">
      import { EditLinksModule } from '/website/shared/editlinks.js';

      let alwaysVisible = true;
      if(document.location.pathname.endsWith("pages/welcome/welcome.html")) {
        alwaysVisible = false;
      }
      EditLinksModule.addEditLinks(alwaysVisible);
    </script>
    <script src="/website/assets/scripts/popper.min.js"></script>
    <script src="/website/assets/scripts/bootstrap.min.js"></script>
<div class="footnote"><sub>

Last updated 2022-02-21 15:42:46 UTC
</sub></div>


<script>
  if(!document.location.pathname.endsWith("pages/welcome/welcome.html")) {
    anchors.options.visible = 'always';
  }
  anchors.add();
</script>
<script>
  var internalUrls = ["https://cginternal.devonfw.com/websitesnippets/"];
  $(".internal").each(function(){
    internalUrls.forEach((internalUrl, index) => {
      $.ajax({url: internalUrl + $(this).text() + "/index.html" })
      .then(r => {
        var leftDiv = $('<div class="info"><span class="infoText">Internal</span><img class="infoImage" src="' + internalUrl + 'logo.png"/></div>');
        var rightFirstDiv = $('<div class="message">This is only visible inside of the corporate network.</div>');
        var rightLastDiv = $('<div class="content"></div>');
        rightLastDiv.html(r);
        var rightDiv = $('<div class="right"></div>');
        rightDiv.append(rightFirstDiv);
        rightDiv.append(rightLastDiv);
        $(this).html(leftDiv);
        $(this).append(rightDiv);
        $(this).addClass("internal-active");
        $(this).removeClass("internal");
      })
    });
	});
</script>
<script>
      let cookieName = 'cookie_consent';
      let expiryTime = new Date(2037, 11, 21);
      let cookieConsentHtml = `
      <div id="cookie-consent">
        <p>
          We use cookies to perform analytics and enhance user experience. Do you accept to the use of cookies?
        </p>
        <p class="cookie-consent-buttons">
          <a id="decline-cookie-btn" class="btn white-button" href="javascript:void(0)">Decline</a>
          <a id="accept-cookie-btn" class="btn blue-button" href="javascript:void(0)">Accept</a>
        </p>
      </div>
      `;

      if (document.cookie.indexOf(cookieName) < 0) {
        $("body").append(cookieConsentHtml);
      }
      $("#accept-cookie-btn").click(function() {
        document.cookie = `${cookieName}=accept;expires=${expiryTime};path=/`;
        consentGranted();
        $("#cookie-consent").hide();
      });
      $("#decline-cookie-btn").click(function() {
        $("#cookie-consent").hide();
      });
</script>

</body></html>